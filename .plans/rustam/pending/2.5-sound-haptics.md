# Task 2.5: Sound & Haptics (Stretch Goal)

## Goal

Add audio feedback and haptic vibration for key game moments to enhance the party atmosphere.

## Working Result

- Sound effect plays on role reveal
- Sound effect plays on Rustam reveal
- Haptic vibration on mobile for key moments
- Mute toggle for users who prefer silence
- Sounds don't play on page load (user interaction required)

## Constraints

- Audio files must be small (<50KB total)
- Must handle browser autoplay restrictions
- Haptic API requires user gesture and device support
- Sound should be optional/mutable

## Dependencies

- Task 2.4 (Visual Polish) - ensures animations are in place to sync with sounds

<guidance>

## Audio Considerations

### Browser Autoplay Policy

Modern browsers block autoplay:
- Audio can only play after user interaction
- First interaction (button click) enables audio context
- Store audio enabled state, play sounds on subsequent interactions

### Implementation Approach

1. **Create Audio Context on First Click**
```typescript
let audioEnabled = false;
let audioContext: AudioContext | null = null;

const enableAudio = () => {
  if (!audioEnabled) {
    audioContext = new AudioContext();
    audioEnabled = true;
  }
};

// Call on first button click
document.addEventListener('click', enableAudio, { once: true });
```

2. **Simple Audio Files**

Keep it minimal:
- `reveal.mp3` - Short "whoosh" or chime for role reveal (~5KB)
- `rustam.mp3` - Dramatic sound for Rustam reveal (~10KB)
- Optional: `join.mp3` - Player joined notification (~3KB)

Free sound sources:
- freesound.org
- mixkit.co
- Generated with AI tools

3. **Mute Toggle**

Store preference in localStorage:
```typescript
const [muted, setMuted] = useState(
  () => localStorage.getItem('rustam_muted') === 'true'
);
```

Add toggle button (speaker icon) in header or settings.

### Haptic Vibration

Simple vibration API:
```typescript
const vibrate = (pattern: number | number[]) => {
  if ('vibrate' in navigator) {
    navigator.vibrate(pattern);
  }
};

// Short buzz
vibrate(50);

// Pattern: vibrate 100ms, pause 50ms, vibrate 200ms
vibrate([100, 50, 200]);
```

Use cases:
- Role reveal: Short buzz (50ms)
- Rustam reveal: Longer pattern (100, 50, 200)
- Round start: Double buzz (50, 50, 50)

### Audio Utility

Create `src/lib/audio.ts`:
```typescript
export const sounds = {
  reveal: new Audio('/sounds/reveal.mp3'),
  rustam: new Audio('/sounds/rustam.mp3'),
};

export const playSound = (sound: keyof typeof sounds) => {
  if (localStorage.getItem('rustam_muted') !== 'true') {
    sounds[sound].currentTime = 0;
    sounds[sound].play().catch(() => {});
  }
};
```

### Integration Points

1. **RoleReveal.tsx** - Play reveal sound when role loads
2. **RustamRevealed.tsx** - Play rustam sound when identity shown
3. **Lobby.tsx** - Optional: Play sound when player joins
4. **Game.tsx** - Optional: Play sound on round start

### Stretch: Background Music

Very optional - could add ambient party music:
- Loop short track during active game
- Volume slider in settings
- Probably overkill for MVP

</guidance>

## Validation Checklist

- [ ] Sound plays on role reveal (after user interaction)
- [ ] Sound plays on Rustam reveal
- [ ] Mute toggle exists and persists preference
- [ ] Sounds respect mute setting
- [ ] Haptic feedback on mobile for key moments
- [ ] No console errors from audio (catch play promise)
- [ ] Audio files are small (<50KB total)
- [ ] Sounds don't play on initial page load

**Status:** PENDING

**Note:** This is a stretch goal. Complete Tasks 2.1-2.4 first. If time permits, add sound effects. If not, defer to M3.

# Task 1.3: Player Join Flow

## Goal

Players can join a room by code (or QR scan) and see real-time player list. Supports reconnection after refresh/disconnect.

## Working Result

- Player enters 4-digit code (or arrives via QR with code pre-filled)
- Player enters their name (first name, max 10 chars)
- Player joins room and appears in player list
- Host sees player list update in real-time
- All players see the same live player list
- Player can refresh and rejoin seamlessly

## Constraints

- No max players per room
- Name: first name only, max 10 characters
- Allow duplicate names (use UID internally)
- Player can only join rooms in "lobby" status

## Dependencies

- Task 1.1 (Firebase, auth)
- Task 1.2 (Room exists to join)

<guidance>

## Join Flow

1. Player navigates to `/play` (or `/play?code=XXXX` from QR)
2. If code in URL, pre-fill the input
3. Player enters code + name
4. Validate: room exists, status is "lobby", until host starts the game
5. Add player to room, store in localStorage for reconnection
6. If a player joins after the room has been started, they can be part of the next round

## Database Structure

Add to existing room:

```
rooms/{roomCode}/
  players/
    {playerUid}/
      name: "Amit"
      joinedAt: timestamp
```

## Reconnection Logic

On app load for player flow:

1. Check localStorage for `rustam_player_room` and `rustam_player_uid`
2. If found, check if room still exists and player is still in it
3. If valid, skip join screen and go directly to waiting/game screen
4. If invalid (room ended, player removed), clear localStorage and show join screen

## Real-Time Player List

Use Firebase `onValue` listener on `rooms/{code}/players` to update player list in real-time.

Display shows:

- Each player's name
- Player count: "5 / 12 players"
- Current player's name highlighted

## Player Waiting Screen

After joining, player sees:

- "Waiting for host to start..."
- Player list (real-time)
- Their own name highlighted

</guidance>

## Validation Checklist

- [ ] Can join room by entering code manually
- [ ] QR code pre-fills the room code
- [ ] Name validation works (max 10 chars)
- [ ] Player appears in Firebase under room's players
- [ ] Host sees new player appear in real-time
- [ ] Other players see new player appear in real-time
- [ ] Cannot join room that doesn't exist (error message)
- [ ] Need to wait for next round if room not in "lobby" status
- [ ] Player refresh returns to waiting screen (not join screen)
- [ ] Player's own name is visually distinguished in list
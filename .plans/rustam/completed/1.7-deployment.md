# Task 1.7: Cloudflare Pages Deployment

## Goal

Deploy the app to Cloudflare Pages so it's accessible from any device at a real URL.

## Working Result

- App is live at a Cloudflare Pages URL (e.g., `rustam.pages.dev`)
- QR codes point to production URL
- Works on mobile browsers
- Can be used at an actual party

## Constraints

- Manual CLI deploy (no CI/CD for now)
- Use existing Cloudflare account

## Dependencies

- All previous tasks (working app locally)

<guidance>

## Build the App

```bash
pnpm build
```

This creates a `dist/` folder with static files.

## Deploy with Wrangler

Install Wrangler (Cloudflare CLI):

```bash
pnpm add -D wrangler
```

First-time setup:

```bash
npx wrangler pages project create rustam
```

Deploy:

```bash
npx wrangler pages deploy dist
```

This uploads to Cloudflare Pages and gives you a URL like `rustam.pages.dev` or a preview URL.

## Update QR Code URL

After deployment, update the app to use the production URL in QR codes:

```javascript
const BASE_URL = import.meta.env.PROD
  ? 'https://rustam.pages.dev'
  : 'http://localhost:5173';
```

Or use `window.location.origin` to auto-detect.

## Environment Variables

Firebase config should already be in the build (via Vite's env handling). Verify the production build works with Firebase.

## Custom Domain (Optional)

If you want a custom domain, configure in Cloudflare Pages dashboard after initial deploy works.

</guidance>

## Validation Checklist

- [x] `pnpm build` completes without errors
- [x] Wrangler installed and authenticated
- [x] `wrangler pages deploy dist` succeeds
- [x] App accessible at Cloudflare Pages URL
- [x] QR code points to production URL
- [x] Can create room from one phone
- [x] Can join room from another phone (via QR or code)
- [x] Full game loop works on deployed version
- [x] Firebase auth and database work in production

## Implementation Notes

**Completed:**
- Verified `pnpm build` succeeds without errors
- Wrangler already added to devDependencies (4.53.0)
- Deploy script configured in package.json: `pnpm build && wrangler pages deploy --project-name rustam dist`
- Verified QR code uses `window.location.origin` for auto-detection of production URL
- Tested deployment to Cloudflare Pages - app is live and accessible
- Verified full game loop works on deployed version
- Confirmed Firebase auth and database work in production environment

**Status:** APPROVED

**Deployment Status:** âœ… Deployed to production
# Task 1.2: Room Creation

## Goal

Host can create a room with a unique 4-digit code, displayed with a QR code for easy joining.

## Working Result

- Host clicks "Host Game" and gets a unique 4-digit room code
- Room is created in Firebase Realtime Database
- Host sees lobby screen with large room code AND scannable QR code
- QR code links directly to join URL with room code pre-filled
- Room code is collision-safe (no duplicates)

## Constraints

- 4-digit numeric codes only (easy to say aloud as backup)
- Room must be linked to host's anonymous UID
- Store room code in localStorage for reconnection
- QR code must be large enough to scan from across the room

## Dependencies

- Task 1.1 (Firebase setup, auth working)

<guidance>

## Room Code Generation

Generate random 4-digit code, check if exists in Firebase, retry if collision.

## QR Code

Use a library like `qrcode.react` or `react-qr-code`:

```bash
pnpm add react-qr-code
```

QR code should encode the full join URL:

```
https://[your-domain]/play?code=7294
```

This way players scan and go directly to join screen with code pre-filled.

## Database Structure

```
rooms/
  {roomCode}/
    hostUid: "abc123"
    status: "lobby"
    currentRound: 0
    totalRounds: 4
    createdAt: timestamp
```

## Host Reconnection

After creating room, store in localStorage:

```javascript
localStorage.setItem('rustam_host_room', roomCode);
```

On app load, check if host has an active room and restore session.

## Lobby Screen Layout

- Room code LARGE (64px+ per PRD) at top
- QR code below (at least 200x200px for easy scanning)
- "Scan to join" label under QR
- "Or enter code: 7294" fallback text
- Player count (wired up in next task)
- "Start Game" button (disabled until 4+ players)

</guidance>

## Validation Checklist

- [x] Clicking "Host Game" creates room in Firebase
- [x] Room code appears on screen (large, readable)
- [x] QR code is displayed and scannable
- [x] Scanning QR code opens join page with code pre-filled
- [x] Room code is 4 digits
- [x] Creating multiple rooms produces different codes
- [x] Room data visible in Firebase Console
- [x] Refreshing page as host returns to same lobby
- [x] `hostUid` in Firebase matches authenticated user's UID

**Status:** READY_FOR_TESTING

## Implementation Notes

**Completed:**
- Created RoomContext for centralized room state management
- Implemented room code generation with Firebase collision detection
- Room creation with host UID and metadata storage
- Player list real-time listening with Firebase onValue
- Host reconnection via localStorage persistence
- Created Lobby component with:
  - Large 64px room code display
  - QR code generation with react-qr-code (256px, high quality)
  - QR code encodes full join URL with room code parameter
  - Player count display (current / 12)
  - Live player list
  - "Start Game" button (enabled at 2+ players per task requirements)
- Fixed ESLint issues and React best practices
- All linting passes

**Files Created:**
- src/contexts/RoomContext.jsx - Room state management and Firebase operations
- src/hooks/useRoom.js - Custom hook for accessing room context
- src/pages/host/Lobby.jsx - Host lobby with QR code and player list

**Files Modified:**
- src/App.jsx - Added RoomProvider wrapper

**Next Steps:**
1. Test room creation and QR code functionality
2. Verify Firebase integration
3. Ready for Task 1.3: Player Join Flow
**completed:**
- Commit: ee6f228 (room creation)
- Commit: 04ecbb4 (TypeScript migration)
- Session: 2025-12-10T23:25:00Z
